{
  "version": 3,
  "sources": ["src/main.ts", "src/apiServer.ts", "src/settings.ts"],
  "sourcesContent": ["import { App, Notice, Plugin } from \"obsidian\";\nimport { APIBridgeServer } from \"./apiServer\";\nimport { APIBridgeSettingTab } from \"./settings\";\n\nexport interface APIBridgeSettings {\n  port: number;\n  authToken: string;\n}\n\nconst DEFAULT_SETTINGS: APIBridgeSettings = {\n  port: 27124,\n  authToken: \"my-secret-token\",\n};\n\nexport default class APIBridgePlugin extends Plugin {\n  settings: APIBridgeSettings;\n  private apiServer: APIBridgeServer;\n\n  async onload() {\n    console.log(\"Loading API Bridge Plugin...\");\n    await this.loadSettings();\n\n    // Initialize and start the API server\n    this.apiServer = new APIBridgeServer(this.app.vault, this.settings);\n    this.apiServer.start();\n\n    // Add the settings tab\n    this.addSettingTab(new APIBridgeSettingTab(this.app, this));\n\n    // Add a command to reload the server\n    this.addCommand({\n      id: \"reload-api-bridge-server\",\n      name: \"Reload API Bridge Server\",\n      callback: async () => {\n        await this.reloadServer();\n        new Notice(\"API Bridge server reloaded.\");\n      },\n    });\n  }\n\n  async onunload() {\n    console.log(\"Unloading API Bridge Plugin...\");\n    this.apiServer.shutdown();\n  }\n\n  async loadSettings() {\n    const data = await this.loadData();\n    this.settings = Object.assign({}, DEFAULT_SETTINGS, data);\n  }\n\n  async saveSettings() {\n    await this.saveData(this.settings);\n  }\n\n  async reloadServer() {\n    this.apiServer.shutdown();\n    this.apiServer = new APIBridgeServer(this.app.vault, this.settings);\n    this.apiServer.start();\n  }\n}\n", "import { Vault, TFile } from \"obsidian\";\nimport { createServer, IncomingMessage, ServerResponse } from \"http\";\nimport { APIBridgeSettings } from \"./main\";\n\nexport class APIBridgeServer {\n  private server: ReturnType<typeof createServer> | null = null;\n  private vault: Vault;\n  private settings: APIBridgeSettings;\n\n  constructor(vault: Vault, settings: APIBridgeSettings) {\n    this.vault = vault;\n    this.settings = settings;\n  }\n\n  start() {\n    // Close any existing server\n    this.shutdown();\n    this.server = createServer((req: IncomingMessage, res: ServerResponse) =>\n      this.handleRequest(req, res)\n    );\n    this.server.listen(this.settings.port, () => {\n      console.log(`API Bridge server listening on port ${this.settings.port}`);\n    });\n  }\n\n  shutdown() {\n    if (this.server) {\n      try {\n        this.server.close();\n        console.log(\"API Bridge server closed.\");\n      } catch (err) {\n        console.error(\"Error closing server:\", err);\n      }\n      this.server = null;\n    }\n  }\n\n  private handleRequest(req: IncomingMessage, res: ServerResponse) {\n    try {\n      if (!this.isAuthorized(req)) {\n        this.unauthorizedResponse(res);\n        return;\n      }\n\n      const url = new URL(req.url ?? \"\", `http://${req.headers.host}`);\n      const method = req.method?.toUpperCase() || \"GET\";\n      const pathParts = url.pathname.split(\"/\").filter(Boolean);\n\n      // GET /api/notes \u2192 list all notes\n      if (method === \"GET\" && pathParts.length === 2) {\n        this.listNotes(res);\n        return;\n      }\n\n      // GET /api/notes/<filePath> \u2192 read a note\n      if (method === \"GET\" && pathParts.length === 3) {\n        const filePath = decodeURIComponent(pathParts[2]);\n        this.readNote(filePath, res);\n        return;\n      }\n\n      // POST /api/notes/<filePath> \u2192 write (create or overwrite) a note\n      if (method === \"POST\" && pathParts.length === 3) {\n        let bodyData = \"\";\n        req.on(\"data\", (chunk) => { bodyData += chunk; });\n        req.on(\"end\", () => {\n          try {\n            const parsedBody = JSON.parse(bodyData);\n            this.writeNote(decodeURIComponent(pathParts[2]), parsedBody, res);\n          } catch (err) {\n            this.internalErrorResponse(res, err as Error);\n          }\n        });\n        return;\n      }\n\n      this.notFoundResponse(res);\n    } catch (err) {\n      console.error(\"Server error:\", err);\n      this.internalErrorResponse(res, err as Error);\n    }\n  }\n\n  private isAuthorized(req: IncomingMessage): boolean {\n    const token = req.headers[\"x-api-token\"];\n    return token === this.settings.authToken;\n  }\n\n  private listNotes(res: ServerResponse) {\n    try {\n      const files = this.vault.getFiles();\n      const fileList = files.map((file) => ({\n        path: file.path,\n        name: file.name,\n      }));\n      res.writeHead(200, { \"Content-Type\": \"application/json\" });\n      res.end(JSON.stringify({ files: fileList }));\n    } catch (err) {\n      this.internalErrorResponse(res, err as Error);\n    }\n  }\n\n  private async readNote(filePath: string, res: ServerResponse) {\n    try {\n      const file = this.vault.getAbstractFileByPath(filePath);\n      if (!file || !(file instanceof TFile)) {\n        this.notFoundResponse(res);\n        return;\n      }\n      const content = await this.vault.read(file);\n      res.writeHead(200, { \"Content-Type\": \"application/json\" });\n      res.end(JSON.stringify({ content }));\n    } catch (err) {\n      this.internalErrorResponse(res, err as Error);\n    }\n  }\n\n  private async writeNote(filePath: string, body: any, res: ServerResponse) {\n    try {\n      const { content } = body ?? {};\n      if (typeof content !== \"string\") {\n        this.badRequestResponse(res, 'Missing \"content\" string in request body.');\n        return;\n      }\n      let file = this.vault.getAbstractFileByPath(filePath);\n      if (!file) {\n        file = await this.vault.create(filePath, content);\n      } else if (!(file instanceof TFile)) {\n        this.badRequestResponse(res, \"Path refers to a folder, not a file.\");\n        return;\n      } else {\n        await this.vault.modify(file, content);\n      }\n      res.writeHead(200, { \"Content-Type\": \"application/json\" });\n      res.end(JSON.stringify({ message: \"File written successfully.\" }));\n    } catch (err) {\n      this.internalErrorResponse(res, err as Error);\n    }\n  }\n\n  private badRequestResponse(res: ServerResponse, message: string) {\n    res.writeHead(400, { \"Content-Type\": \"application/json\" });\n    res.end(JSON.stringify({ error: message }));\n  }\n\n  private notFoundResponse(res: ServerResponse) {\n    res.writeHead(404, { \"Content-Type\": \"application/json\" });\n    res.end(JSON.stringify({ error: \"Not found\" }));\n  }\n\n  private unauthorizedResponse(res: ServerResponse) {\n    res.writeHead(401, { \"Content-Type\": \"application/json\" });\n    res.end(JSON.stringify({ error: \"Unauthorized\" }));\n  }\n\n  private internalErrorResponse(res: ServerResponse, err: Error) {\n    res.writeHead(500, { \"Content-Type\": \"application/json\" });\n    res.end(JSON.stringify({ error: err.message }));\n  }\n}\n", "import { App, Notice, PluginSettingTab, Setting } from \"obsidian\";\nimport APIBridgePlugin from \"./main\";\n\nexport class APIBridgeSettingTab extends PluginSettingTab {\n  plugin: APIBridgePlugin;\n\n  constructor(app: App, plugin: APIBridgePlugin) {\n    super(app, plugin);\n    this.plugin = plugin;\n  }\n\n  display(): void {\n    const { containerEl } = this;\n    containerEl.empty();\n    containerEl.createEl(\"h2\", { text: \"API Bridge Settings\" });\n\n    // Port setting\n    new Setting(containerEl)\n      .setName(\"Port\")\n      .setDesc(\"Port on which the local API server will listen.\")\n      .addText((text) =>\n        text\n          .setPlaceholder(\"27124\")\n          .setValue(String(this.plugin.settings.port))\n          .onChange(async (value) => {\n            const port = Number(value);\n            if (!isNaN(port)) {\n              this.plugin.settings.port = port;\n              await this.plugin.saveSettings();\n              await this.plugin.reloadServer();\n              new Notice(`API server port updated to ${port} and restarted.`);\n            }\n          })\n      );\n\n    // Auth Token setting\n    new Setting(containerEl)\n      .setName(\"Auth Token\")\n      .setDesc(\"Requests must include this token in the X-API-Token header.\")\n      .addText((text) =>\n        text\n          .setPlaceholder(\"my-secret-token\")\n          .setValue(this.plugin.settings.authToken)\n          .onChange(async (value) => {\n            this.plugin.settings.authToken = value.trim();\n            await this.plugin.saveSettings();\n            new Notice(\"Auth token updated.\");\n          })\n      );\n  }\n}\n"],
  "mappings": "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",
  "names": ["main_exports", "__export", "APIBridgePlugin", "__toCommonJS", "import_obsidian", "import_obsidian", "import_http", "APIBridgeServer", "vault", "settings", "req", "res", "err", "url", "method", "pathParts", "filePath", "bodyData", "chunk", "parsedBody", "fileList", "file", "content", "body", "message", "import_obsidian", "APIBridgeSettingTab", "app", "plugin", "containerEl", "text", "value", "port", "DEFAULT_SETTINGS", "APIBridgePlugin", "APIBridgeServer", "APIBridgeSettingTab", "data"]
}
